USE [CSIDW]
GO
/****** Object:  StoredProcedure [dbo].[Web_SR_UpdateSalesRepresentative]    Script Date: 11/7/2017 10:40:48 AM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

　
ALTER PROCEDURE [dbo].[Web_SR_UpdateSalesRepresentative]
     @SalesRepContactID INT = NULL
	,@SalesRepFirstName NVARCHAR(50)=NULL
	,@SalesRepLastName NVARCHAR(50)=NULL
	,@Title NVARCHAR(250) = NULL
	,@CompanyName NVARCHAR(250) = NULL
	,@SalesRepCompanyName NVARCHAR(100)=NULL
	,@WorkPhone NVARCHAR(100)=NULL
	,@SalesRepTypeName NVARCHAR(100)=NULL
	,@TerritoryName NVARCHAR(100)=NULL
	,@RegionName NVARCHAR(100)=NULL
	,@SubBusinessUnitName NVARCHAR(100)=NULL
	,@BusinessUnitName NVARCHAR(100)=NULL
	,@VoiceMailExtension NVARCHAR(50)=NULL
	,@FaxNumber NVARCHAR(50)=NULL
	,@MobilePhone NVARCHAR(50)=NULL
	,@Pager NVARCHAR(50)=NULL
	,@PersonalCellPhone NVARCHAR(50)=NULL
	,@InternationalPhone NVARCHAR(50)=NULL
	,@InternationalFax NVARCHAR(50)=NULL
	,@InternationalCell NVARCHAR(50)=NULL
	,@PrimaryEmail NVARCHAR(50)=NULL
	,@SecondaryEmail NVARCHAR(50)=NULL
	,@EffectiveDate DATETIME	
	,@ExpirationDate DATETIME = NULL
	,@UpdateUser NVARCHAR(100) = NULL
AS
SET NOCOUNT ON;

DECLARE @SalesRepTypeID INT=NULL
DECLARE @TerritoryID INT=NULL
DECLARE @RegionID INT=NULL
DECLARE @SubBusinessUnitID INT=NULL
DECLARE @BusinessUnitID INT=NULL
DECLARE @CompanyID INT=NULL
DECLARE @SalesRepID INT=NULL

IF (@CompanyName IS NOT NULL)
BEGIN
	SET @CompanyID = (
			SELECT TOP 1 [CompanyID]
			FROM [dbo].[Company]
			WHERE [CompanyName] = @CompanyName
			);
END

　
IF (@SalesRepTypeName IS NOT NULL)
BEGIN
	SET @SalesRepTypeID = (
			SELECT TOP 1 [SalesRepTypeID]
			FROM [dbo].[SalesRepType]
			WHERE [SalesRepTypeName] = @SalesRepTypeName
			);
END

IF (@TerritoryName IS NOT NULL)
BEGIN
	SET @TerritoryID = (
			SELECT TOP 1 [TerritoryID]
			FROM [dbo].[Territory]
			WHERE [TerritoryName] = @TerritoryName
			);
END

IF (@RegionName IS NOT NULL)
BEGIN
	SET @RegionID = (
			SELECT TOP 1 [RegionID]
			FROM [dbo].[Region]
			WHERE [RegionName] = @RegionName
			);
END

IF (@SubBusinessUnitName IS NOT NULL)
BEGIN
	SET @SubBusinessUnitID = (
			SELECT TOP 1 [SubBusinessUnitID]
			FROM [dbo].[SubBusinessUnit]
			WHERE [SubBusinessUnitName] = @SubBusinessUnitName
			);
END

IF (@BusinessUnitName IS NOT NULL)
BEGIN
	SET @BusinessUnitID = (
			SELECT TOP 1 [BusinessUnitID]
			FROM [dbo].[BusinessUnit]
			WHERE [BusinessUnitName] = @BusinessUnitName
			);
END

　
ELSE 
BEGIN 
UPDATE [CSIDW].[dbo].[SalesRepContact]
SET   [Title]= @Title
      ,[CompanyID]= @CompanyID
	  ,[BusinessUnitID]= @BusinessUnitID
	  ,[SubBusinessUnitID]= @SubBusinessUnitID
	  ,[RegionID] = @RegionID
	  ,[TerritoryID] = @TerritoryID
	  ,[SalesRepTypeID] = @SalesRepTypeID
	  ,[SalesRepCompanyName]= @SalesRepCompanyName
	  ,[VoiceMailExtension]= @VoiceMailExtension 
	  ,[FaxNumber]= @FaxNumber 
	  ,[MobilePhone]=  @MobilePhone 
	  ,[Pager] =  @Pager
	  ,[PersonalCellPhone]= @PersonalCellPhone 
	  ,[InternationalPhone]= @InternationalPhone
	  ,[InternationalFax]=  @InternationalFax 
	  ,[InternationalCell]=  @InternationalCell 
	  ,[PrimaryEmail]= @PrimaryEmail 
	  ,[SecondaryEmail]= @SecondaryEmail 
      ,[EffectiveDate] = @EffectiveDate
	  ,[ExpirationDate] = @ExpirationDate
	  ,[UpdateUser] = @UpdateUser
	  ,[UpdateDate] = GETDATE()
WHERE [SalesRepContactID] = @SalesRepContactID

　
　
UPDATE [CSIDW].[dbo].[SalesRep]
SET   [SalesRepFirstName]= @SalesRepFirstName
      ,[SalesRepLastName]= @SalesRepLastName
      ,[EffectiveDate] = @EffectiveDate
	  ,[ExpirationDate] = @ExpirationDate
	  ,[UpdateUser] = @UpdateUser
	  ,[UpdateDate] = GETDATE()
WHERE [SalesRepID] = @SalesRepID
	SELECT 'Success'
END

　
　
　
　
